<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DataLoader.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ReCollect</a> &gt; <a href="index.source.html" class="el_package">ua.tqs.ReCollect</a> &gt; <span class="el_source">DataLoader.java</span></div><h1>DataLoader.java</h1><pre class="source lang-java linenums">package ua.tqs.ReCollect;

import java.io.InputStream;
import java.math.BigDecimal;
import java.net.URL;
import java.nio.charset.StandardCharsets;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.Map;

import com.fasterxml.jackson.databind.ObjectMapper;

import org.apache.commons.io.IOUtils;
import org.apache.log4j.Logger;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.ApplicationArguments;
import org.springframework.boot.ApplicationRunner;
import org.springframework.core.io.ResourceLoader;
import org.springframework.stereotype.Component;
import org.springframework.transaction.annotation.Transactional;

import ua.tqs.ReCollect.model.Categories;
import ua.tqs.ReCollect.model.Comment;
import ua.tqs.ReCollect.model.Item;
import ua.tqs.ReCollect.model.Location;
import ua.tqs.ReCollect.model.User;
import ua.tqs.ReCollect.repository.CommentRepository;
import ua.tqs.ReCollect.repository.ItemRepository;
import ua.tqs.ReCollect.service.CommentService;
import ua.tqs.ReCollect.service.ItemService;
import ua.tqs.ReCollect.service.LocationService;
import ua.tqs.ReCollect.service.UserService;

@Component
@Transactional
<span class="fc" id="L36">public class DataLoader implements ApplicationRunner {</span>

    @Autowired
    private LocationService locationService;

    @Autowired
    private UserService userService;

    @Autowired
    private ItemService itemService;

    @Autowired
    private CommentService commentService;

    @Autowired
    private CommentRepository commentRepository;

    @Autowired
    private ItemRepository itemRepository;

<span class="fc" id="L56">    static final Logger logger = Logger.getLogger(DataLoader.class);</span>

    @Autowired
    private ResourceLoader rl;

    @Override
    public void run(ApplicationArguments args) throws Exception {
        //loading locations
<span class="pc bpc" id="L64" title="1 of 2 branches missed.">        if (locationService.getAll().size() != 308) {</span>
<span class="nc" id="L65">            locationService.deleteAll();</span>
<span class="nc" id="L66">            String fileName = &quot;cdpt.json&quot;;</span>
<span class="nc" id="L67">            InputStream inputStream = rl.getResource(&quot;classpath:static/&quot; + fileName).getInputStream();</span>
<span class="nc" id="L68">            String cdpt = IOUtils.toString(inputStream, StandardCharsets.UTF_8);</span>
<span class="nc" id="L69">            ObjectMapper mapper = new ObjectMapper();</span>
<span class="nc" id="L70">            Map&lt;String, ArrayList&lt;String&gt;&gt; map = mapper.readValue(cdpt, Map.class);</span>

<span class="nc" id="L72">            Iterator&lt;String&gt; keys = map.keySet().iterator();</span>
<span class="nc bnc" id="L73" title="All 2 branches missed.">            while (keys.hasNext()) {</span>
<span class="nc" id="L74">                String district = keys.next();</span>
<span class="nc" id="L75">                ArrayList&lt;String&gt; counties = map.get(district);</span>
<span class="nc bnc" id="L76" title="All 2 branches missed.">                for (String county : counties) {</span>
<span class="nc" id="L77">                    locationService.save(new Location(county, district));</span>
<span class="nc" id="L78">                }</span>
<span class="nc" id="L79">            }</span>

<span class="nc" id="L81">            logger.info(&quot;Finished loading &quot; + locationService.getAll().size() + &quot; locations&quot;);</span>

<span class="nc" id="L83">        } else {</span>
<span class="fc" id="L84">            logger.debug(&quot;up and running&quot;);</span>
        }
        // loading users
<span class="fc" id="L87">        String emailCarlos=&quot;carlos@mail.com&quot;;</span>
<span class="fc" id="L88">        String emailSofia=&quot;sofia@mail.com&quot;;</span>
<span class="fc" id="L89">        String emailPedro=&quot;pedro@mail.com&quot;;</span>
<span class="pc bpc" id="L90" title="5 of 6 branches missed.">        if (!userService.userExists(emailCarlos) || !userService.userExists(emailSofia) || !userService.userExists(emailPedro)) {</span>
<span class="fc" id="L91">            userService.deleteAll();</span>

<span class="fc" id="L93">            userService.register(new User(&quot;Carlos&quot;,emailCarlos, &quot;carlos&quot;, &quot;123456789&quot;,</span>
<span class="fc" id="L94">                    locationService.getLocation(&quot;Aveiro&quot;, &quot;Aveiro&quot;)));</span>

<span class="fc" id="L96">            userService.register(new User(&quot;Sofia&quot;, emailSofia, &quot;sofia&quot;, &quot;123789456&quot;,</span>
<span class="fc" id="L97">                    locationService.getLocation(&quot;Coimbra&quot;, &quot;Mira&quot;)));</span>

<span class="fc" id="L99">            userService.register(new User(&quot;Pedro&quot;, emailPedro, &quot;pedro&quot;, &quot;456789123&quot;,</span>
<span class="fc" id="L100">                    locationService.getLocation(&quot;Lisboa&quot;, &quot;Mafra&quot;)));</span>
        }
<span class="fc" id="L102">        logger.debug(userService.getAll());</span>

        //loading items

<span class="fc" id="L106">        itemService.deleteAll();</span>

<span class="fc" id="L108">        User carlos=userService.getByEmail(emailCarlos);</span>
<span class="fc" id="L109">        User sofia=userService.getByEmail(emailSofia);</span>
<span class="fc" id="L110">        User pedro=userService.getByEmail(emailPedro);</span>

<span class="fc" id="L112">        Item i1= new Item(&quot;2019 Great Britain Silver Britannia 1 oz .999 BU £2 Brilliant Uncirculated&quot;, 1, BigDecimal.valueOf(41.0), &quot;Moeda rara&quot;, Categories.MISC);</span>
<span class="fc" id="L113">        i1.setOwner(carlos);</span>
<span class="fc" id="L114">        i1.addImage(new URL(&quot;https://images-na.ssl-images-amazon.com/images/I/81aA62TVZeL._SL1500_.jpg&quot;));</span>
<span class="fc" id="L115">        itemRepository.saveAndFlush(i1);</span>

<span class="fc" id="L117">        Item i2= new Item(&quot;The Cocktail Party [assinado]&quot;, 1, BigDecimal.valueOf(200.0), &quot;Livro antigo, assinado&quot;, Categories.BOOKS);</span>
<span class="fc" id="L118">        i2.setOwner(carlos);</span>
<span class="fc" id="L119">        i2.addImage(new URL(&quot;https://pictures.abebooks.com/LONDONRAREBOOKS/md/md30097028036.jpg&quot;));</span>
<span class="fc" id="L120">        itemRepository.saveAndFlush(i2);</span>

<span class="fc" id="L122">        Item i3= new Item(&quot;Vintage Vinyl, Black Sabbath Volume 4. Vertigo Records 1972&quot;, 1, BigDecimal.valueOf(23.0), &quot;Disco vinyl antigo&quot;, Categories.MUSIC);</span>
<span class="fc" id="L123">        i3.setOwner(sofia);</span>
<span class="fc" id="L124">        i3.addImage(new URL(&quot;https://i.ebayimg.com/images/g/TosAAOSw7Rdext5W/s-l1600.jpg&quot;));</span>
<span class="fc" id="L125">        itemRepository.saveAndFlush(i3);</span>

<span class="fc" id="L127">        Item i4= new Item(&quot;Japanese Art Print Dusk by Koho Shoda Vintage Poster, Painting Print, Japanese, Ukiyo e #1098&quot;, 1, BigDecimal.valueOf(20.0), &quot;Quadro raro&quot;, Categories.ART);</span>
<span class="fc" id="L128">        i4.setSeller(sofia);</span>
<span class="fc" id="L129">        i4.addImage(new URL(&quot;https://i.etsystatic.com/16900491/r/il/c479db/1938837110/il_1140xN.1938837110_au3l.jpg&quot;));</span>
<span class="fc" id="L130">        itemRepository.saveAndFlush(i4);</span>

<span class="fc" id="L132">        Item i5= new Item(&quot;1922-1935 Peace Silver Dollar BU&quot;, 1, BigDecimal.valueOf(27.0), &quot;Moeda rara&quot;, Categories.MISC);</span>
<span class="fc" id="L133">        i5.setOwner(pedro);</span>
<span class="fc" id="L134">        i5.addImage(new URL(&quot;https://www.images-apmex.com/images/Catalog%20Images/Products/170_Obv.jpg?v=20191107093552&amp;width=900&amp;height=900&quot;));</span>
<span class="fc" id="L135">        itemRepository.saveAndFlush(i5);</span>

<span class="fc" id="L137">        Item i6= new Item(&quot;Complete Exodia the Forbidden One Set - All 5 Cards :: 1st Edition LDK2 Mint YuG&quot;, 2, BigDecimal.valueOf(17.0), &quot;Cartas raras&quot;, Categories.GAMES);</span>
<span class="fc" id="L138">        i6.setOwner(pedro);</span>
<span class="fc" id="L139">        i6.addImage(new URL(&quot;https://i.ebayimg.com/images/g/sOEAAOSwKtVeVorv/s-l1600.jpg&quot;));</span>
<span class="fc" id="L140">        itemRepository.saveAndFlush(i6);</span>

<span class="fc" id="L142">        logger.debug(itemService.getAll());</span>

        //loading comments

<span class="fc" id="L146">        commentService.deleteAll();</span>

<span class="fc" id="L148">        Comment c1=new Comment(&quot;Em bom estado!&quot;, carlos, i6);</span>
<span class="fc" id="L149">        commentRepository.saveAndFlush(c1);</span>
        
<span class="fc" id="L151">        Comment c2=new Comment(&quot;5 estrelas&quot;, pedro, i3);</span>
<span class="fc" id="L152">        commentRepository.saveAndFlush(c2);</span>
        
<span class="fc" id="L154">        Comment c3=new Comment(&quot;Tinha uma página rasgada...&quot;, pedro, i2);</span>
<span class="fc" id="L155">        commentRepository.saveAndFlush(c3);</span>

<span class="fc" id="L157">        logger.debug(commentService.getAll());</span>

<span class="fc" id="L159">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>